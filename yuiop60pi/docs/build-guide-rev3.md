# YUIOP60Pi rev.3 ビルドガイド

## キット以外に必要なもの

### 部品

* Cherry MX互換キースイッチ - 60個 ([参考1][sw1], [参考2][sw2], [参考3][sw3])
* スタビライザー - 合計3個 ([参考1][st1], [参考2][st2])
  * 2u - 2個
  * 6.25u - 1個
* キーキャップセット - 1セット ([参考1][kc1], [参考2][kc2], [参考3][kc3])
* 60%キーボードケース (GH60, DZ60互換推奨) ([参考1][ca1], [参考2][ca2], [参考3][ca3])
* USB micro B ケーブル ([参考1][cb1], [参考2][cb2])

[cb1]:https://shop.yushakobo.jp/collections/accessory/products/usb-cable-micro-b-0-8m
[cb2]:https://talpkeyboard.net/items/5df82904a551d528d7360c34
[ca1]:https://shop.yushakobo.jp/collections/case/products/60-plastic-case
[ca2]:https://shop.yushakobo.jp/collections/case/products/1429
[ca3]:https://talpkeyboard.net/items/615ff26eacbcb077a5d5dd19
[kc1]:https://shop.yushakobo.jp/collections/keycaps/products/3272
[kc2]:https://shop.yushakobo.jp/collections/keycaps/products/2775
[kc3]:https://shop.yushakobo.jp/collections/keycaps/products/pbt-gray-dye-sub-keycaps
[st1]:https://shop.yushakobo.jp/collections/all-keyboard-parts/products/a0500st?variant=37665699463329
[st2]:https://talpkeyboard.net/?category_id=5f884b9b3313d216eb50558a&target=instock
[sw1]:https://shop.yushakobo.jp/collections/all-switches/cherry-mx-%E4%BA%92%E6%8F%9B-%E3%82%B9%E3%82%A4%E3%83%83%E3%83%81
[sw2]:https://talpkeyboard.net/?category_id=59cf8860ed05e668db003f5d&target=instock
[sw3]:https://kochikeyboard.stores.jp/?category_id=5f79187d07e16366f031382a&target=instock

### 機材

* ニッパー: ピンヘッダーのピンを切断するのに使います
* ハンダコテ: [FX600-02](https://ec.hakko.com/products/detail/4066) 推奨
  * コテ先: [T18-CF15](https://ec.hakko.com/products/detail/4186) 推奨
* コテ台+クリーナー: [633-01](https://ec.hakko.com/products/detail/3421) 推奨
* ハンダ線: 鉛入り 直径0.6mm 推奨
* フラックス
* ピンセット各種
* 精密プラスドライバー No.0
* 精密プラスドライバー No.00
* 拡大鏡 (オプション)
* テスター (オプション)
* ナットドライバー 対辺4mm (オプション)

## ビルドの前に

下の図はYUIOP60Piの完成時の構成概要です。

![YUIOP60Pi構成概要](./abstract-structure.png)

* トッププレートとPCBは`YUIOP60Pi`というロゴが印刷されたほうが表(上)側です
* トッププレートとPCBの間にはPGA2040、スタビライザー、スペーサーが挟まります
* その他の電子部品はPCBの裏面にハンダ付けします
* PGA2040はRP2040が実装されている面を下、すなわちPCBのほうに向けます
* PGA2040とPCBは6x2ピンヘッダーを4個使って接続します

## ビルド手順

(TODO: 各工程のコツを解説、作業動画の該当部分へのリンクを追加)

1.  PGA2040にピンヘッダーをハンダ付けし余ったピンを切ります

    まずPCB表側の`U1`に6x2ピンヘッダー4個を挿入します。
    この時PCB自体を浮かせピンヘッダーが根元まで入るようにします。

    PGA2040をピンヘッダーに挿入します。
    PCBに挿入したピンヘッダーの上から、PGA2040の裏側を上にして、左に90度回転させてピンヘッダーに挿入します。
    PGA2040の小さな部品群が実装された面が上になります。
    回転方向はPGA2040上のロゴとPCBのシルク印刷も目安にしてください。

    PGA2040の裏側(上側)の四隅のピンヘッダーをハンダ付けし、4個のピンヘッダーを仮止めします。
    PGA2040とピンヘッダーの間に隙間ができないように気を付けてください。

    PGA2040側からはみ出たピンをPGA2040の部品よりも低くなるようにニッパー等で切断します。
    誤ってPGA2040上の部品を切断しないように気を付けてください。
    いったんピンヘッダーをPCBから取り外すと作業しやすいです。

    PGA2040の裏側(上側)のハンダ付けしてないピンヘッダー44箇所をハンダ付けします。
    スルーホール内のハンダ塗れを良くするためフラックスの使用を推奨します。
    ハンダを盛りすぎないように気を付けてください。
    目安としてはPGA2040上の部品群の高さを超えないことです。

    四隅のピンのハンダを温めなおし切断した際の応力を抜きましょう。

    これでいったんPGA2040とピンヘッダーの工作は終了です。
    PCBから外してよけておきましょう。

2.  USBレセプタクル(`J1`)をハンダ付けします

    USBレセプタクル(以下レセプタクル)を`J1`に挿入します。
    レセプタクルの足がある方をPCB裏側に、USBケーブルを接続するほうを基板のエッジに向けて挿入します。

    USBレセプタクルの正しい位置を確認します。
    レセプタクルの取り付けには本キット中で最も高い精度が要求されます。
    レセプタクルから伸びる5本のピンとPCB上の対応する5個のパッドがピタリと合い、ピンが浮かない場所が正しい位置です。
    この位置はレセプタクルをPCBのエッジに軽く押し付ける、
    またはPCBを少し傾斜させることで得られます。
    この時点で正しい位置をよく確認しましょう。

    レセプタクルの手前側の足を1本だけハンダ付けし、仮止めします。
    ハンダコテを右で握るなら右手前の足を、左で握るなら左手前の足をハンダ付けします。
    ハンダ濡れを良くするためにフラックスの使用を推奨します。
    コテの温度は320℃が目安です。
    この際レセプタクルが熱くなるので火傷しないように注意してください。

    レセプタクルの位置を調整します。
    この時点で先に確認しておいたレセプタクルの正しい位置になるように微調整してください。
    先にハンダ付けした1本の足を温めながらピンセット等で位置を調整します。
    正しい位置に納まったらゆっくりとハンダコテを離し、
    ハンダが固まったのを確認してから再度正しい位置にあるかを確認しましょう。

    レセプタクルの残りの足3箇所をハンダ付けし、固定します。
    手前側はPCB裏側から、残り2か所はひっくり返して表側からハンダ付けしてください。
    ハンダ濡れを良くするためにフラックスの使用を推奨します。
    近くに別の部品用のパッドがあるためハンダを盛りすぎないように気を付けましょう。

    レセプタクルのピンをハンダ付けします。
    コテの温度は270℃が目安です。
    コツとしてはピンとパッドにフラックスを塗り、コテ先にハンダを少しだけ融かし付け、それをピンとパッドに当てて少し待つ感じです。
    仮にピン同士がブリッジしても気にせず、まずは全部のピンとパッドにハンダが回ることを優先しましょう。

    ピン同士のブリッジがある場合にはリカバリーします。
    ブリッジした場所にフラックスを塗り綺麗に清掃したコテ先を当てると、余分なハンダをコテ先に移すことでリカバリーできます。
    1回で取り切れない場合は複数回同じことを繰り返しましょう。

    ハンダの付けすぎには注意してください。
    コテ先がT18-CF15であれば直径0.6mmのハンダ線を2mm融かすのを2回くらいの量で、ピンとパッドのハンダ付けには充分足ります。
    ハンダを付けすぎるとピン同士だけではなく、レセプタクルカバーにブリッジしてしまいます。
    カバーとの間でブリッジした場合はコテの温度を320℃まで上げたほうがリカバリーはしやすいです。

    この時点でレセプタクルのハンダ付けが成功しているかテスターでテストできます。
    詳しくは[USBレセプタクルのテスト](#test-usb-receptacle)を参照してください。

3.  ショットキーバリアダイオード(`DS1`)とリセッタブルヒューズ(`F1`)をハンダ付けします

    `DS1`は取り付け方向が決まっているのでチップ上の縦線をシルク印刷の縦線の方向に合わてください。

4.  RGB LEDを取り付けます (オプション)

    RGB LEDを取り付けない場合、この一連の工程は省略できます。

    1.  抵抗2個(`R1`, `R2`)とMOSFET(`Q1`)をハンダ付けします
    2.  コンデンサ2個(`C1`, `C4`)をハンダ付けします

        PCBには`C1`から`C4`までありますが`C1`と`C4`だけハンダ付けすれば充分です

    3.  WS2812C-2020(以下LED)を56個(`LED1`から`LED56`)をハンダ付けします

        LEDは取り付け方向が決まっているので、チップ裏の緑の縦線をシルク印刷の縦線の方向に合わせてください

5.  ダイオード60個をハンダ付けします

    ダイオードは取り付け方向が決まっているので、チップ上の縦線をシルク印刷の縦線の方向に合わせてください

6.  スイッチソケット60個(`KSW1`から`KSW60`)をハンダ付けします

    取り付け方向はシルク印刷に合わせてください。

7.  表面実装タクタイルスイッチ(`RSW1`)をハンダ付けします

8.  PGA2040(`U1`)をPCBにハンダ付けして余ったピンを切ります

9.  スタビライザーを取り付けます

    `KSW30`, `KSW42`, `KSW58`にスタビライザーを取り付けます

10. PCBとトッププレートをスペーサーとネジで固定します

    トッププレートはあらかじめ裏面から削っておくとキースイッチが抜けにくくなります

    1.  PCBの裏側からなべ小ねじ(銀色)を挿入し、表側から六角スペーサーで止めます(計6箇所)
    2.  トッププレートをスペーサーを挟むようにPCBに重ね、表からスリムヘッド小ねじで止めます(計6箇所)

    取り付け時にねじは緩めにしておき、最後に軽く締めるくらいが良いです

11. キースイッチを挿入し、ケースに取り付け、キーキャップを取り付けたら完成です

## ファームウェアの書き込み手順

ボタン(RSW1)を押しながらYUIOP60PiをUSBケーブルを接続する(≒YUIOP60Piの電源を入れる)とUSBドライブとして認識されます。
そのドライブにファームウェアのファイル(例: yuiop60pi.uf2)を書き込めばファームウェアの書き込みは完了です。
書き込みが終わると自動的にドライブは取り外されYUIOP60Piがキーボードとして機能します。

## ビルドのTIPS

(TODO: 要望・余裕があったら追加する)

### <a id="test-usb-receptacle">USBレセプタクルのテスト</a>

(TODO: 書く)

## ファームウェアのTIPS

(TODO: 要望・余裕があったら書く)
